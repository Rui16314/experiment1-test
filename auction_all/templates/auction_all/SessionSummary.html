
{% extends 'auction_all/Base.html' %}
{% block content %}
<h2>Session results â€” {{ phase_label }}</h2>

<div class="chart-box">
  <h5>1) Average bid vs valuation (all players)</h5>
  <canvas id="c1"></canvas>
  <div id="c1_empty" class="text-muted small" style="display:none;">No data to display.</div>
</div>

<div class="chart-box">
  <h5>2) Individual average bid vs valuation (one chart per student)</h5>
  <div id="indiv"></div>
  <div id="indiv_empty" class="text-muted small" style="display:none;">No data to display.</div>
</div>

<div class="chart-box">
  <h5>3) Average revenue (winning price) by round</h5>
  <canvas id="c3"></canvas>
  <div id="c3_empty" class="text-muted small" style="display:none;">No data to display.</div>
</div>

<div class="chart-box">
  <h5>4) Your average payoff (this session)</h5>
  <div class="display-6">{{ my_avg_payoff_str }}</div>
</div>

<form method="post"><button class="btn btn-primary mt-4">Continue</button></form>

<script>
const s1 = {{ avg_bid_by_val|safe }};
if (s1.length) {
  new Chart(document.getElementById('c1'),{type:'line',data:{datasets:[{label:'Avg bid',data:s1}]},options:{parsing:false,scales:{x:{title:{display:true,text:'Valuation'}},y:{title:{display:true,text:'Avg Bid'}}}}});
} else { document.getElementById('c1_empty').style.display='block'; }

const indiv = {{ indiv_series|safe }};
const wrap=document.getElementById('indiv');
if (indiv.length) {
  indiv.forEach(series=>{const c=document.createElement('canvas');wrap.appendChild(c);new Chart(c,{type:'line',data:{datasets:[{label:'Participant '+series.pid,data:series.points}]},options:{parsing:false,scales:{x:{title:{display:true,text:'Valuation'}},y:{title:{display:true,text:'Avg Bid'}}}}});});
} else { document.getElementById('indiv_empty').style.display='block'; }

const s3 = {{ rev_by_round|safe }};
if (s3.length) {
  new Chart(document.getElementById('c3'),{type:'line',data:{datasets:[{label:'Avg revenue',data:s3}]},options:{parsing:false,scales:{x:{title:{display:true,text:'Round (within session)'}},y:{title:{display:true,text:'Revenue'}}}}});
} else { document.getElementById('c3_empty').style.display='block'; }
</script>
{% endblock %}
