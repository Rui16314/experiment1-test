{% extends 'global/Page.html' %}

{% block content %}
<h2>Session results â€” {{ phase_label }}</h2>

<div class="card" style="padding:16px; max-width:1000px;">
  <h4>1) Average bid vs valuation (all players)</h4>
  <div id="chart1" class="chart-box"></div>

  <h4>2) Individual average bid vs valuation (one chart per student)</h4>
  <div id="chart2" class="chart-box"></div>

  <h4>3) Average revenue (winning price) by round</h4>
  <div id="chart3" class="chart-box"></div>

  <h4>4) Your overall average revenue (this session)</h4>
  <div><strong>{{ my_avg_payoff_str }}</strong></div>
</div>

<form method="post"><button class="btn btn-primary">Continue</button></form>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const s1 = {{ avg_bid_by_val | safe }};
  const indiv = {{ indiv_series | safe }};
  const s3 = {{ rev_by_round | safe }};

  function renderLine(ctx, data, label){
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.map(d=>d.x),
        datasets: [{ label: label, data: data.map(d=>d.y), fill:false, tension:0.1 }]
      },
      options: { maintainAspectRatio: false, responsive: true }
    });
  }

  const c1 = document.createElement('canvas');
  c1.style.width = '700px'; c1.style.height = '300px';
  document.getElementById('chart1').appendChild(c1);
  renderLine(c1, s1, 'Avg bid');

  const c3 = document.createElement('canvas');
  c3.style.width = '700px'; c3.style.height = '300px';
  document.getElementById('chart3').appendChild(c3);
  renderLine(c3, s3, 'Avg revenue');

  const c2 = document.createElement('canvas');
  c2.style.width = '700px'; c2.style.height = '300px';
  document.getElementById('chart2').appendChild(c2);
  if (indiv.length>0){
    const first = indiv[0].points || [];
    renderLine(c2, first, 'Sample student');
  }
</script>
{% endblock %}
